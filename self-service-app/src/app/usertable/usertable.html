<div class="w-full bg-white shadow-md rounded-2xl p-6 space-y-4">

  <!-- Header + status chips + text filter -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
    <h2 class="text-xl font-semibold text-slate-800">
      Users Table
    </h2>

    <div class="flex flex-col md:flex-row md:items-center gap-2">
      <!-- Status chips -->
      <!-- <div class="inline-flex rounded-xl border border-slate-200 bg-slate-50 p-1">
        <button
          type="button"
          (click)="setStatusFilter('All')"
          class="px-3 py-1 text-xs md:text-sm font-medium rounded-lg"
          [class.bg-indigo-600]="filterStatus() === 'All'"
          [class.text-white]="filterStatus() === 'All'"
          [class.text-slate-700]="filterStatus() !== 'All'"
        >
          All
        </button>
        <button
          type="button"
          (click)="setStatusFilter('Immune')"
          class="px-3 py-1 text-xs md:text-sm font-medium rounded-lg"
          [class.bg-green-600]="filterStatus() === 'Immune'"
          [class.text-white]="filterStatus() === 'Immune'"
          [class.text-slate-700]="filterStatus() !== 'Immune'"
        >
          Immune
        </button>
        <button
          type="button"
          (click)="setStatusFilter('Non-Immune')"
          class="px-3 py-1 text-xs md:text-sm font-medium rounded-lg"
          [class.bg-rose-600]="filterStatus() === 'Non-Immune'"
          [class.text-white]="filterStatus() === 'Non-Immune'"
          [class.text-slate-700]="filterStatus() !== 'Non-Immune'"
        >
          Non-Immune
        </button>
        <button
          type="button"
          (click)="setStatusFilter('Unknown')"
          class="px-3 py-1 text-xs md:text-sm font-medium rounded-lg"
          [class.bg-amber-500]="filterStatus() === 'Unknown'"
          [class.text-white]="filterStatus() === 'Unknown'"
          [class.text-slate-700]="filterStatus() !== 'Unknown'"
        >
          Unknown
        </button>
      </div> -->

      <!-- Free text filter -->
      <div class="flex items-center gap-2">
        <span class="text-xs text-slate-500">Filter in table</span>
        <input type="text" class="w-40 md:w-56 rounded-xl border border-slate-200 bg-slate-50 px-3 py-1.5 text-xs
                 text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2
                 focus:ring-indigo-300 focus:border-indigo-500" placeholder="name, phone, year…"
          [ngModel]="filterText()" (ngModelChange)="setFilterText($event)" />
      </div>
    </div>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto">
    <table class="min-w-full text-left text-sm">
      <!-- YOUR THEAD (unchanged) -->
      <thead>
        <tr class="border-b border-slate-200 bg-slate-50">
          <!-- ID -->
          <th class="px-4 py-2 font-semibold text-slate-700 cursor-pointer select-none" (click)="setSort('id')">
            <div class="flex items-center gap-1">
              ID
              <fa-icon [icon]="
                  sortField() === 'id'
                    ? (sortDirection() === 'asc' ? faSortUp : faSortDown)
                    : faSort
                " class="h-3 w-3" [ngClass]="{
                  'text-indigo-500': sortField() === 'id',
                  'text-slate-400': sortField() !== 'id'
                }"></fa-icon>
            </div>
          </th>

          <!-- Name -->
          <th class="px-4 py-2 font-semibold text-slate-700 cursor-pointer select-none" (click)="setSort('name')">
            <div class="flex items-center gap-1">
              Name
              <fa-icon [icon]="
                  sortField() === 'name'
                    ? (sortDirection() === 'asc' ? faSortUp : faSortDown)
                    : faSort
                " class="h-3 w-3" [ngClass]="{
                  'text-indigo-500': sortField() === 'name',
                  'text-slate-400': sortField() !== 'name'
                }"></fa-icon>
            </div>
          </th>

          <!-- Immune Status -->
          <th class="px-4 py-2 font-semibold text-slate-700 cursor-pointer select-none"
            (click)="setSort('immuneStatus')">
            <div class="flex items-center gap-1">
              Immune Status
              <fa-icon [icon]="
                  sortField() === 'immuneStatus'
                    ? (sortDirection() === 'asc' ? faSortUp : faSortDown)
                    : faSort
                " class="h-3 w-3" [ngClass]="{
                  'text-indigo-500': sortField() === 'immuneStatus',
                  'text-slate-400': sortField() !== 'immuneStatus'
                }"></fa-icon>
            </div>
          </th>

          <!-- Year of Birth -->
          <th class="px-4 py-2 font-semibold text-slate-700 cursor-pointer select-none"
            (click)="setSort('yearOfBirth')">
            <div class="flex items-center gap-1">
              Year of Birth
              <fa-icon [icon]="
                  sortField() === 'yearOfBirth'
                    ? (sortDirection() === 'asc' ? faSortUp : faSortDown)
                    : faSort
                " class="h-3 w-3" [ngClass]="{
                  'text-indigo-500': sortField() === 'yearOfBirth',
                  'text-slate-400': sortField() !== 'yearOfBirth'
                }"></fa-icon>
            </div>
          </th>

          <!-- Phone (not sortable) -->
          <th class="px-4 py-2 font-semibold text-slate-700">
            Phone Number
          </th>
        </tr>
      </thead>

      <tbody>
        <!-- ✅ SKELETON MODE: show while loading is true -->
        @if (loading()) {
        @for (row of [0,1,2,3,4]; track row) {
        <tr class="border-b border-slate-100 animate-pulse">
          <td class="px-4 py-3">
            <div class="h-3 w-8 rounded bg-slate-200"></div>
          </td>
          <td class="px-4 py-3">
            <div class="h-3 w-32 rounded bg-slate-200"></div>
          </td>
          <td class="px-4 py-3">
            <div class="h-5 w-20 rounded-full bg-slate-200"></div>
          </td>
          <td class="px-4 py-3">
            <div class="h-3 w-16 rounded bg-slate-200"></div>
          </td>
          <td class="px-4 py-3">
            <div class="h-3 w-28 rounded bg-slate-200"></div>
          </td>
        </tr>
        }
        } @else {
        <!-- NORMAL DATA MODE -->
        @for (user of filteredAndSortedUsers(); track user.id) {
        <tr class="border-b border-slate-100 hover:bg-slate-50">
          <td class="px-4 py-2 text-slate-600">
            {{ user.id }}
          </td>

          <td class="px-4 py-2 text-slate-800 font-medium">
            {{ user.name }}
          </td>

          <td class="px-4 py-2">
            <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold" [ngClass]="{
              'bg-green-50 text-green-700': user.immuneStatus === 'Immune',
              'bg-rose-50 text-rose-700': user.immuneStatus === 'Non-Immune',
              'bg-amber-50 text-amber-700': user.immuneStatus === 'Unknown'
            }">
              {{ user.immuneStatus }}
            </span>
          </td>

          <td class="px-4 py-2 text-slate-700">
            {{ user.yearOfBirth }}
          </td>

          <td class="px-4 py-2 text-slate-700">
            {{ user.phoneNumber }}
          </td>
        </tr>
        }
        @empty {
        <tr>
          <td colspan="5" class="px-4 py-4 text-center text-slate-500 text-sm">
            No users to display yet. Run an LLM query like
            <span class="italic">
              "Give me all sorted users who is non immune"
            </span>.
          </td>
        </tr>
        }
        }
      </tbody>

    </table>
  </div>
</div>
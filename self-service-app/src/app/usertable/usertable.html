<div class="w-full bg-white shadow-xl rounded-2xl p-6 md:p-8 space-y-4  md:h-[780px] flex flex-col">

  <!-- Header + status chips + text filter -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
    <h2 class="text-xl font-semibold text-slate-800">
      <fa-icon [icon]="faUsers"
        class="mt-1 inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-emerald-50 text-emerald-500"></fa-icon>
      Staff Directory
    </h2>


    <div class="flex flex-col md:flex-row md:items-center gap-2">
      <!-- Status chips -->
      <!-- <div class="inline-flex rounded-xl border border-slate-200 bg-slate-50 p-1">
        <button
          type="button"
          (click)="setStatusFilter('All')"
          class="px-3 py-1 text-xs md:text-sm font-medium rounded-lg"
          [class.bg-indigo-600]="filterStatus() === 'All'"
          [class.text-white]="filterStatus() === 'All'"
          [class.text-slate-700]="filterStatus() !== 'All'"
        >
          All
        </button>
        <button
          type="button"
          (click)="setStatusFilter('Immune')"
          class="px-3 py-1 text-xs md:text-sm font-medium rounded-lg"
          [class.bg-green-600]="filterStatus() === 'Immune'"
          [class.text-white]="filterStatus() === 'Immune'"
          [class.text-slate-700]="filterStatus() !== 'Immune'"
        >
          Immune
        </button>
        <button
          type="button"
          (click)="setStatusFilter('Non-Immune')"
          class="px-3 py-1 text-xs md:text-sm font-medium rounded-lg"
          [class.bg-rose-600]="filterStatus() === 'Non-Immune'"
          [class.text-white]="filterStatus() === 'Non-Immune'"
          [class.text-slate-700]="filterStatus() !== 'Non-Immune'"
        >
          Non-Immune
        </button>
        <button
          type="button"
          (click)="setStatusFilter('Unknown')"
          class="px-3 py-1 text-xs md:text-sm font-medium rounded-lg"
          [class.bg-amber-500]="filterStatus() === 'Unknown'"
          [class.text-white]="filterStatus() === 'Unknown'"
          [class.text-slate-700]="filterStatus() !== 'Unknown'"
        >
          Unknown
        </button>
      </div> -->

      <!-- Free text filter -->
      <div class="flex items-center gap-2">
        <span class="text-xs text-slate-500">Filter in table</span>
        <input type="text" class="w-40 md:w-56 rounded-xl border border-slate-200 bg-slate-50 px-3 py-1.5 text-xs
                 text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2
                 focus:ring-indigo-300 focus:border-indigo-500" placeholder="name, phone, year…"
          [ngModel]="filterText()" (ngModelChange)="setFilterText($event)" />
      </div>
    </div>
  </div>

  <!-- Table -->
  <div class="overflow-auto flex-1">
    <table class="min-w-full text-left text-sm">
      <!-- YOUR THEAD (unchanged) -->
      <thead>
        <tr class="border-b border-slate-200 bg-slate-50">
          <!-- ID -->
          <th class="px-4 py-2 font-semibold text-slate-700 cursor-pointer select-none" (click)="setSort('id')">
            <div class="flex items-center gap-1">
              ID
              <fa-icon [icon]="
                  sortField() === 'id'
                    ? (sortDirection() === 'asc' ? faSortUp : faSortDown)
                    : faSort
                " class="h-3 w-3" [ngClass]="{
                  'text-indigo-500': sortField() === 'id',
                  'text-slate-400': sortField() !== 'id'
                }"></fa-icon>
            </div>
          </th>

          <!-- Name -->
          <th class="px-4 py-2 font-semibold text-slate-700 cursor-pointer select-none" (click)="setSort('name')">
            <div class="flex items-center gap-1">
              Name
              <fa-icon [icon]="
                  sortField() === 'name'
                    ? (sortDirection() === 'asc' ? faSortUp : faSortDown)
                    : faSort
                " class="h-3 w-3" [ngClass]="{
                  'text-indigo-500': sortField() === 'name',
                  'text-slate-400': sortField() !== 'name'
                }"></fa-icon>
            </div>
          </th>

          <!-- Immune Status -->
          <th class="px-4 py-2 font-semibold text-slate-700 cursor-pointer select-none"
            (click)="setSort('immuneStatus')">
            <div class="flex items-center gap-1">
              Immune Status
              <fa-icon [icon]="
                  sortField() === 'immuneStatus'
                    ? (sortDirection() === 'asc' ? faSortUp : faSortDown)
                    : faSort
                " class="h-3 w-3" [ngClass]="{
                  'text-indigo-500': sortField() === 'immuneStatus',
                  'text-slate-400': sortField() !== 'immuneStatus'
                }"></fa-icon>
            </div>
          </th>

          <!-- Year of Birth -->
          <th class="px-4 py-2 font-semibold text-slate-700 cursor-pointer select-none"
            (click)="setSort('yearOfBirth')">
            <div class="flex items-center gap-1">
              Year of Birth
              <fa-icon [icon]="
                  sortField() === 'yearOfBirth'
                    ? (sortDirection() === 'asc' ? faSortUp : faSortDown)
                    : faSort
                " class="h-3 w-3" [ngClass]="{
                  'text-indigo-500': sortField() === 'yearOfBirth',
                  'text-slate-400': sortField() !== 'yearOfBirth'
                }"></fa-icon>
            </div>
          </th>

          <!-- Phone -->
          <th class="px-4 py-2 font-semibold text-slate-700">
            Phone Number
          </th>
        </tr>
      </thead>

      <tbody>
        <!-- SKELETON MODE: show while loading is true -->
        @if (loading()) {
        @for (row of [0,1,2,3,4]; track row) {
        <tr class="border-b border-slate-100 animate-pulse">
          <td class="px-4 py-3">
            <div class="h-3 w-8 rounded bg-slate-200"></div>
          </td>
          <td class="px-4 py-3">
            <div class="h-3 w-32 rounded bg-slate-200"></div>
          </td>
          <td class="px-4 py-3">
            <div class="h-5 w-20 rounded-full bg-slate-200"></div>
          </td>
          <td class="px-4 py-3">
            <div class="h-3 w-16 rounded bg-slate-200"></div>
          </td>
          <td class="px-4 py-3">
            <div class="h-3 w-28 rounded bg-slate-200"></div>
          </td>
        </tr>
        }
        } @else {
        <!-- NORMAL DATA MODE -->
        @for (user of pagedUsers(); track user.id) {
        <tr class="border-b border-slate-100 hover:bg-slate-50">
          <td class="px-4 py-2 text-slate-600">
            {{ user.id }}
          </td>

          <td class="px-4 py-2 text-slate-800 font-medium">
            {{ user.name }}
          </td>

          <td class="px-4 py-2">
            <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold" [ngClass]="{
              'bg-green-50 text-green-700': user.immuneStatus === 'Immune',
              'bg-rose-50 text-rose-700': user.immuneStatus === 'Non-Immune',
              'bg-amber-50 text-amber-700': user.immuneStatus === 'Unknown'
            }">
              {{ user.immuneStatus }}
            </span>
          </td>

          <td class="px-4 py-2 text-slate-700">
            {{ user.yearOfBirth }}
          </td>

          <td class="px-4 py-2 text-slate-700">
            {{ user.phoneNumber }}
          </td>
        </tr>
        }
        @empty {
        <tr>
          <td colspan="5" class="px-4 py-8">
            <div class="max-w-xl mx-auto rounded-2xl border border-dashed border-emerald-200
             bg-emerald-50/60 px-6 py-6 text-center shadow-sm">
              <div class="mx-auto mb-3 flex h-10 w-10 items-center justify-center rounded-full
               bg-emerald-100 text-emerald-600">
                <fa-icon [icon]="faUsers" class="text-lg"></fa-icon>
              </div>

              <h3 class="text-sm font-semibold text-slate-800 mb-1">
                No matching staff found
              </h3>

              @let term = filterText() || lastQuery();

              @if (term) {
              <p class="text-xs text-slate-500 mb-2">
                We couldn’t find anyone matching
                <span class="font-semibold text-slate-700">
                  “{{ term }}”
                </span>.
              </p>
              }

              <p class="text-xs text-slate-500 leading-relaxed">
                Try searching using <span class="font-semibold">staff details</span> such as
                <span class="font-semibold">name</span>,
                <span class="font-semibold">phone number</span> or
                <span class="font-semibold">year of birth</span>.
                You can also ask the AI on the right, for example:
                <span class="italic">
                  “Show all non-immune staff born after 1990.”
                </span>
              </p>
            </div>
          </td>
        </tr>
        }


        }
      </tbody>

    </table>
    <!-- Pagination footer -->
    <div
      class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 px-4 py-3 border-t border-slate-200 bg-slate-50 rounded-b-2xl">
      <!-- Left: range info -->
      <div class="text-xs text-slate-500">
        @let total = filteredAndSortedUsers().length;
        @let page = currentPage();
        @let start = (page - 1) * pageSize + 1;
        <!-- use ternary -->
        @let end = (page * pageSize) > total ? total : (page * pageSize);

        @if (total === 0) {
        <span>Showing 0 of 0 staff.</span>
        } @else {
        <span>Showing {{ start }}–{{ end }} of {{ total }} staff.</span>
        }
      </div>

      <!-- Right: page controls -->
      <div class="inline-flex items-center gap-1">
        <button type="button" (click)="previousPage()" [disabled]="currentPage() === 1" class="px-3 py-1.5 text-xs font-medium rounded-lg border border-slate-200
             bg-white text-slate-600 hover:bg-slate-100
             disabled:opacity-40 disabled:cursor-not-allowed">
          Prev
        </button>

        @for (pageNumber of pages(); track pageNumber) {
        <button type="button" (click)="goToPage(pageNumber)"
          class="px-3 py-1.5 text-xs font-semibold rounded-lg border transition-colors" [ngClass]="{
          'bg-indigo-600 text-white border-indigo-600 shadow-sm':
            currentPage() === pageNumber,
          'bg-white text-slate-600 border-slate-200 hover:bg-slate-100':
            currentPage() !== pageNumber
        }">
          {{ pageNumber }}
        </button>
        }

        <button type="button" (click)="nextPage()" [disabled]="currentPage() === totalPages()" class="px-3 py-1.5 text-xs font-medium rounded-lg border border-slate-200
             bg-white text-slate-600 hover:bg-slate-100
             disabled:opacity-40 disabled:cursor-not-allowed">
          Next
        </button>
      </div>
    </div>


  </div>
</div>